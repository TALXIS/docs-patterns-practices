{
	"Create a new Power Platform developer environment": {
		"scope": "powershell",
		"prefix": "CFD01-create-dev-env",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║               CFD01: Create a new Power Platform developer environment                 ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# Creating a Power Platform developer environment is significantly easier than traditional",
			"# PaaS/IaaS setups. With a single command, all the required infrastructure (backend, frontend,",
			"# database, networking, APIs and security) is ready in few moments.",
			"#",
			"# Any user can create up to 3 developer environments for free by assigning themselves the",
			"# Power Apps Developer Plan (https://aka.ms/PowerApps/DeveloperPlan).",
			"#",
			"# In larger projects, you may set up automation to deploy daily CI builds into a queue",
			"# of environments that developers can claim and use for their feature implementation.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"",
			"# Create a new developer environment (this may take some time).",
			"",
			"pac admin create `",
			"--name \"${1:Inventory Management Demo DEV}\" `",
			"--currency ${2:EUR} `",
			"--region ${3:europe} `",
			"--type ${4:Developer} `",
			"--domain $$devEnvDomain",
			"",
			"# Clear this file with Ctrl+A & Delete. Then type CFD02 and select the snippet to continue."
		]
	},
	"Authenticate and connect to the development environment": {
		"scope": "powershell",
		"prefix": "CFD02-auth-connect-dev-env",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║              CFD02: Authenticate and connect to the development environment            ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# We authenticate to the PAC CLI previously, but we need to create a new authentication profile",
			"# for the development environment. This allows us to switch between different environments",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"",
			"# Step 1: Authenticate and connect to the development environment",
			"pac auth create --environment \\$devEnvUrl --name \"\\$devEnvAuthProfileName\"",
			"",
			"# Step 2: Select the authentication profile",
			"pac auth select --name \"\\$devEnvAuthProfileName\"",
			"",
			"# Clear this file with Ctrl+A & Delete. Then type CFD03 and select the snippet to continue."
		]
	},
	"Create a test environment": {
		"scope": "powershell",
		"prefix": "CFD03-create-test-environment",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║                         CFD03: Create a test environment                               ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# A test environment (UAT) is used for testing your solutions before they are deployed ",
			"# to production. You should use Sandbox type of environment but here we will use Developer type",
			"# to make the demo work for users without premium licenses and admin rights.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Create a new test environment.",
			"",
			"pac admin create `",
			"--name \"${1:Inventory Management Demo UAT}\" `",
			"--currency ${2:EUR} `",
			"--region ${3:europe} `",
			"--type ${4:Developer} `",
			"--domain \\$uatEnvDomain",
			"",
			"# Step 2: Authenticate and connect to the development environment",
			"pac auth create --environment \\$uatEnvUrl --name \"\\$uatEnvAuthProfileName\"",
			"",
			"# Step 3: Select the DEV environment authentication profile (it got switched to UAT in the previous step)",
			"pac auth list",
			"pac auth select --name \"\\$devEnvAuthProfileName\"",
			"",
			"# Clear this file with Ctrl+A & Delete. Then type CFD04 and select the snippet to continue."
		]
	},
	"Add a test user to the test environment": {
		"scope": "powershell",
		"prefix": "CFD04-add-test-user",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║                        CFD04: Add a test user to environments                          ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# You can add other users to your environment (sharing dev envs is not a good practice!)",
			"# In this step, we will add a test user to the development and test environments.",
			"# This user will be used for running automated UI tests.",
			"#",
			"# Note that the value for the user parameter should be username, not email",
			"# It is recommended to create a less privileged security role for test users",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Add a test user to the development and test environments.",
			"",
			"pac admin assign-user `",
			"--user $$testUserName `",
			"--role $$testUserRole `",
			"--environment $$devEnvUrl",
			"",
			"pac admin assign-user `",
			"--user $$testUserName `",
			"--role $$testUserRole `",
			"--environment $$uatEnvUrl",
			"",
			"# Clear this file with Ctrl+A & Delete. Then type CFD05 and select the snippet to continue."
		]
	},
	"Create a Service Principal (no Azure roles)": {
		"scope": "powershell",
		"prefix": "CFD05-create-test-service-principal",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║                  CFD05: Create a Service Principal for test automation                 ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# This command creates an Entra ID (AAD) Service Principal without assigning any roles.",
			"# This is useful for test automation scenarios where you want to be swithing security roles",
			"# of the interactive user and you need a service principal to assign those roles in Dataverse",
			"# or orchestrate test data.",
			"#",
			"# PAC CLI does support creating service principals, but it requires privileged access",
			"# to Power Platform administration APIs. This way you can create a service principal",
			"# without any Power Platform Admin role and without registering a Power Platform admin app.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                      Command",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Create a Service Principal for a deployment pipeline.",
			"$$testUserServicePrincipal = az ad sp create-for-rbac `",
			"  --name \"${1:Demo of Power Apps Deployment Automation} \\${$randomIdentifier}\" `",
			"  --skip-assignment `",
			"  | ConvertFrom-Json",
			"",
			"# Step 2: Create a Service Principal for test automation.",
			"$$deploymentUserServicePrincipal = az ad sp create-for-rbac `",
			"  --name \"${1:Demo of Power Apps Test Automation} \\${$randomIdentifier}\" `",
			"  --skip-assignment `",
			"  | ConvertFrom-Json",
			"",
			"# Step 3: Wait 15 seconds to let service principals propagate",
			"Start-Sleep -Seconds 15",
			"",
			"# Step 4: Assign Service Principals to the development and test environments",
			"",
			"pac admin assign-user `",
			"--user $$testUserServicePrincipal.appId `",
			"--application-user `",
			"--role \"$$testServicePrincipalRole\" `",
			"--environment $$devEnvUrl",
			"",
			"pac admin assign-user `",
			"--user $$testUserServicePrincipal.appId `",
			"--application-user `",
			"--role \"$$testServicePrincipalRole\" `",
			"--environment $$uatEnvUrl",
			"",
			"pac admin assign-user `",
			"--user $$deploymentUserServicePrincipal.appId `",
			"--application-user `",
			"--role \"$$deploymentServicePrincipalRole\" `",
			"--environment $$uatEnvUrl",
			"",
			"# Step 3: Open Power Platform Admin Center (PPAC) to review created environments",
			"Start-Process \"https://admin.powerplatform.microsoft.com/environments\"",
			"",
			"",
			"# Continue with the next module by typing CFE..."
		]
	}
}