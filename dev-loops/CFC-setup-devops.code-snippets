{
	"Create an Azure DevOps remote repository and push changes": {
		"scope": "powershell",
		"prefix": "CFC01-create-remote-repo",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║            CFC01: Create an Azure DevOps remote repository and push changes            ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# A remote repository is can be hosted on a platform like Azure DevOps or GitHub.",
			"# It allows multiple developers to collaborate on the same project by pushing and pulling",
			"# changes. When a developer pushes changes to the remote, others can pull those changes into ",
			"# their local repositories, ensuring everyone is working with the latest code.",
			"#",
			"# Continuous Integration (CI) is an automated process where changes pushed to the remote ",
			"# repository trigger builds and tests, ensuring that the codebase remains functional. ",
			"# Integrating changes frequently helps avoid conflicts and errors in larger teams.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"",
			"# Step 1: Create a new Azure DevOps project with Git as the source control",
			"az devops project create --name \\$adoProjectName --source-control git --organization \"https://dev.azure.com/\\$adoOrgName\"",
			"",
			"# Wait for the project to be created",
			"Start-Sleep -Seconds 5",
			"",
			"# Step 2: Connect the local Git repository to the new remote repository",
			"git remote add origin \"https://\\$adoOrgName@dev.azure.com/\\$adoOrgName/\\$adoProjectName/_git/\\$adoRepositoryName\"",
			"",
			"# Step 3: Get the repository ID",
			"\\$repositoryObject = az repos show --repository \\$adoRepositoryName --project \"\\$adoProjectName\" --output json",
			"\\$repositoryId = (\\$repositoryObject | ConvertFrom-Json).id",
			"",
			"# Step 4: Push the current changes to the remote repository",
			"git push -u origin --all",
			"",
			"# Wait for the push to complete",
			"Start-Sleep -Seconds 5",
			"",
			"# Step 5: Open the project in a browser",
			"az devops project show --open --project \\$adoProjectName",
			"",
			"# Clear this file with Ctrl+A & Delete. Then type CFC02 and select the snippet to continue",
			"# with setting up a branch policy to prevent direct pushes to the main branch.",
		]
	},
	"Set up branch policy to prevent direct pushes to main": {
		"scope": "powershell",
		"prefix": "CFC02-setup-branch-policy",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║             CFC02: Set up branch policy to prevent direct pushes to ${1:main}          ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# A branch policy is essential for maintaining code quality and stability in a collaborative",
			"# development environment. By preventing direct pushes to the ${1:main} branch, you ensure that all",
			"# changes go through a review process via pull requests (PRs).",
			"# This allows other team members to review, comment, and approve changes before they are merged ",
			"# into the ${1:main} branch, reducing the risk of bugs or issues being introduced into production code.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Set up the branch policy to require at least one approver and prevent direct pushes to '${1:main}'.",
			"az repos policy approver-count create `",
			"--allow-downvotes true `",
			"--blocking true `",
			"--creator-vote-counts true `",
			"--enabled true `",
			"--minimum-approver-count 1 `",
			"--reset-on-source-push true `",
			"--branch \"${1:main}\" `",
			"--repository \\$repositoryId `",
			"--project \"\\$adoProjectName\"",
			"",
			"# Step 2: Review the branch policy settings in the Azure DevOps project settings",
			"Start-Process \"https://dev.azure.com/\\$adoOrgName/\\$adoProjectName/_settings/repositories?_a=policiesMid&repo=\\$repositoryId&refs=refs/heads/${1:main}\"",
			"",
			"# Clear this file with Ctrl+A & Delete. Then type CFC03 and select the snippet to continue",
			"# with creating a pull request to merge changes into the main branch.",
		]
	},
	"Create a pull request to merge changes into main branch": {
		"scope": "powershell",
		"prefix": "CFC03-create-pull-request",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║             CFC03: Create a pull request to merge changes into main branch             ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# A pull request (PR) is a request to merge changes from one branch into another, typically",
			"# from a user branch into the main branch. It allows team members to review the changes,",
			"# provide feedback and approve the changes before they are merged. This process helps maintain",
			"# code quality and ensures that all changes are properly vetted before being integrated into",
			"# the main codebase.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Create a pull request to merge changes from the current branch into the main branch",
			"$$pullRequest = az repos pr create `",
			"--source-branch \"$$userBranchPrefix${2:/project-setup}\" `",
			"--target-branch \"${1:main}\" `",
			"--title \"chore: Initial project setup\" `",
			"--description \"This pull request sets up the initial project structure and configuration.\" `",
			"--delete-source-branch true `",
			"--auto-complete true `",
			"--project $$adoProjectName `",
			"--repository $$repositoryId `",
			"| ConvertFrom-Json",
			"",
			"# Step 2: Open the pull request in a web browser for review and approval",
			"az repos pr show --id $$pullRequest.pullRequestId --open",
			"",
			"# Clear this file with Ctrl+A & Delete. Then type CFC04 and select the snippet to continue."
		]
	},
	"Approve the pull request": {
		"scope": "powershell",
		"prefix": "CFC04-approve-pull-request",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║         CFC04: Approve the pull request to merge changes and pull updated main         ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# The previously created pull request needs to be approved because we have set up a branch policy",
			"# that requires at least one approver before merging changes into the main branch. This step",
			"# ensures that the changes are reviewed and approved by a team member",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Approve the pull request if you have not done so already in the Azure DevOps web interface",
			"az repos pr set-vote `",
			"--id $$pullRequest.pullRequestId `",
			"--vote approve",
			"",
			"# Step 2: Wait for the pull request to be merged automatically by Azure DevOps",
			"Start-Sleep -Seconds 10",
			"",
			"# Step 3: Checkout the main branch and pull the latest changes from the remote",
			"git checkout main",
			"git pull origin main",
			"",
			"# Clear this file with Ctrl+A & Delete. Then type CFD01 and select the snippet to continue",
			"# with setting up the development and test environments.",
		]
	}
}