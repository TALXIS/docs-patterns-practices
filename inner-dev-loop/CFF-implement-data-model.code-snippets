{
	"Create a Dataverse solution project for a database schema": {
		"scope": "powershell",
		"prefix": "CFF01-create-model-solution",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║                CFF01: Create a Dataverse solution project for a database schema        ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# We will use the .NET templating engine (dotnet new) to create a Dataverse solution project.",
			"# The .NET templating engine is a system that allows us to define project templates",
			"#",
			"# Unlike the Power Platform CLI, which generates projects that require post-processing to be ",
			"# compatible with .NET project system, this template from the TALXIS.DevKit.Templates.Dataverse",
			"# package resolves those issues.",
			"#",
			"# You can check out how the templates are built and used:",
			"# https://github.com/TALXIS/tools-devkit-templates",
			"#",
			"# Templates automatically add new projects to the .sln file.",
			"# If you wanted to do it manually you would use the following command:",
			"# dotnet sln add src/Solutions.DataModel",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Sync main and create a new branch for introducing a database schema.",
			"git checkout main",
			"git pull origin main",
			"git checkout -b \"${1:users/tomas.prokop/add-data-model}\"",
			"",
			"# Step 2: Create a solution project for the database schema using the installed template.",
			"dotnet new pp-solution `",
			"--output \"src\\${2:Solutions.DataModel}\" `",
			"--PublisherName \"${3:tomas}\" `",
			"--PublisherPrefix \"${4:tom}\" `",
			"--allow-scripts yes",
			"",
			"# Templates automatically add new projects to the .sln file.",
			"# If you wanted to do it manually you would use the following command:",
			"# dotnet sln add src/Solutions.DataModel",
			"",
			"# Step 3: Add the solution project to the Package Deployer project as a .NET ProjectReference item.",
			"cd src/Packages.Main",
			"pac package add-reference --path ../${2:Solutions.DataModel}/",
			"cd ../..",
			"",
		]
	},
	"Create database tables in the model solution": {
		"scope": "powershell",
		"prefix": "CFF02-create-tables",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║                  CFF02: Create new tables in Dataverse model solution                  ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# We will create new tables in the Dataverse solution for tracking items and transactions.",
			"# Dataverse supports multiple table types and in this case, we are adding a Standard table.",
			"#",
			"# There is a difference between adding all table metadata to a solution and adding a table",
			"# reference to a solution. The reference allows adding columns, views, forms, and ribbon buttons.",
			"# This is controlled by the --Behavior argument, which can be set to either 'New' or 'Existing'.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Add Warehouse Item table to the solution",
			"dotnet new pp-entity `",
			"--output \"src/${1:Solutions.DataModel}\" `",
			"--EntityType \"${2:Standard}\" `",
			"--Behavior \"${3:New}\" `",
			"--PublisherPrefix \"${4:tom}\" `",
			"--LogicalName \"${5:warehouseitem}\" `",
			"--LogicalNamePlural \"${6:warehouseitems}\" `",
			"--DisplayName \"${7:Warehouse Item}\" `",
			"--DisplayNamePlural \"${8:Warehouse Items}\" `",
			"--SolutionRootPath \"${9:Declarations}\" `",
			"--allow-scripts yes",
			"",
			"# Step 2: Add Warehouse Transaction table to the solution",
			"dotnet new pp-entity `",
			"--output \"src/${1:Solutions.DataModel}\" `",
			"--EntityType \"${2:Standard}\" `",
			"--Behavior \"${3:New}\" `",
			"--PublisherPrefix \"${4:tom}\" `",
			"--LogicalName \"warehousetransaction\" `",
			"--LogicalNamePlural \"warehousetransactions\" `",
			"--DisplayName \"Warehouse Transaction\" `",
			"--DisplayNamePlural \"Warehouse Transactions\" `",
			"--SolutionRootPath \"${9:Declarations}\" `",
			"--allow-scripts yes",
		]
	},
	"Add attributes to the tables in the model solution": {
		"scope": "powershell",
		"prefix": "CFF03-add-attributes",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║                   CFF03: Add columns to the previously created tables                  ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# In Dataverse, tables are made up of columns.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Add Available Quantity column to the Warehouse Item table",
			"dotnet new pp-entity-attribute `",
			"--output \"src/${1:Solutions.DataModel}\" `",
			"--EntitySchemaName \"${2:tom_warehouseitem}\" `",
			"--AttributeType \"${3:WholeNumber}\" `",
			"--RequiredLevel \"${4:required}\" `",
			"--PublisherPrefix \"${5:tom}\" `",
			"--LogicalName \"${6:availablequantity}\" `",
			"--DisplayName \"${7:Available Quantity}\" `",
			"--SolutionRootPath \"${8:Declarations}\" `",
			"--allow-scripts yes",
			"",
			"# Step 2: Add Item column to the Warehouse transaction table",
			"dotnet new pp-entity-attribute `",
			"--output \"src\\Solutions.DataModel\" `",
			"--EntitySchemaName \"tom_warehousetransaction\" `",
			"--AttributeType \"Lookup\" `",
			"--RequiredLevel \"required\" `",
			"--PublisherPrefix \"tom\" `",
			"--LogicalName \"itemid\" `",
			"--DisplayName \"Item\" `",
			"--ReferencedEntityName \"tom_warehouseitem\" `",
			"--SolutionRootPath \"Declarations\" `",
			"--allow-scripts yes",
			"",
			"# Step 3: Add Quantity column to the Warehouse transaction table",
			"dotnet new pp-entity-attribute `",
			"--output \"src/${1:Solutions.DataModel}\" `",
			"--EntitySchemaName \"tom_warehousetransaction\" `",
			"--AttributeType \"${3:WholeNumber}\" `",
			"--RequiredLevel \"${4:required}\" `",
			"--PublisherPrefix \"${5:tom}\" `",
			"--LogicalName \"quantity\" `",
			"--DisplayName \"Quantity\" `",
			"--SolutionRootPath \"${8:Declarations}\" `",
			"--allow-scripts yes",
			"",
		]
	},
	"Build solution.zip files which can be imported": {
		"scope": "powershell",
		"prefix": "CFF04-build-solutions",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║                  CFF04: Build a solution.zip file which can be imported                ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# Dataverse solutions come in two forms: unmanaged and managed.",
			"#",
			"# Unmanaged solutions are for development and act as containers for tracking components.",
			"# When deleted, components remain in the system. Use them to export definitions from your",
			"# environment to source control.",
			"#",
			"# Managed solutions are for deployments. They layer component definitions, support merging",
			"# of some components (diffs) and can be uninstalled if there are no dependencies. Import",
			"# order is important. 'Managed properties' can restrict modifications to components.",
			"#",
			"# Production environments should not contain unmanaged components and unmanaged customizations",
			"# should not be made in the Active layer.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                      Solution Building",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Import unmanaged solutions into developer environments for modifications with web tools. You",
			"# need managed solutions to create layers and track diffs for syncing to source control.",
			"#",
			"# To build both types, set `<Managed>2</Managed>` in Solution.xml. The Solution Package Tool",
			"# (SPT) can then pack both types from source. Microsoft.PowerApps.MSBuild.Solution NuGet",
			"# triggers SPT when running the `Build` target (e.g., 'dotnet build').",
			"#",
			"# For PDPackage projects, use the `Publish` target to generate deployment packages.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Build the solution project to generate the solution.zip file.",
			"dotnet build ./src/Solutions.DataModel --configuration Debug",
			"",
			"",
			"# Alternatively you can call the following command to build all solutions in the repository",
			"# It invokes 'Publish' target on the Package Deployer project, which builds all solutions",
			"# which are referenced in the PDPackage project and then generates a package file.",
			"dotnet publish --configuration Debug"
		]
	},
	"Import the new solution into your DEV environment": {
		"scope": "powershell",
		"prefix": "CFF05-import-model-sync-changes",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║            CFF05: Import the solution to DEV environment and sync changes              ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# Once we have created the solution and built the solution.zip file, we can import it",
			"# into the development environment. This allows us to test the solution and make changes",
			"# if needed. The import process will create the tables and columns in the Dataverse environment.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Import the solution into the development environment",
			"cd \"./src/Solutions.DataModel/\"",
			"pac solution import",
			"cd ../..",
			"",
			"# Step 2: Publish All Customizations",
			"pac solution publish",
			"",
			"# Step 3: Commit the changes before making modifications",
			"git add --all",
			"git commit -m \"${1:feat: Add new entities}\"",
			"",
			"# Step 4: Open the Power Apps Maker in the web browser and make modifications",
			"pac tool maker",
			"",
			"# Step 5: Sync changes from the Data Model solution",
			"cd \"./src/Solutions.DataModel/\"",
			"pac solution sync --packagetype Both --solution-folder Declarations",
			"cd ../.."
		]
	},
	"Create a pull request to integrate pipelines into the main branch": {
		"scope": "powershell",
		"prefix": "CFF06-create-pipelines-pull-request",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║          CFF06: Create a pull request to integrate changes into the main branch        ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# Step 1: Add all the changes to the staging area",
			"git add --all",
			"",
			"# Step 2: Commit the changes with a descriptive message",
			"git commit -m \"${1:feat: Add warehouse item and transaction tables with attributes}\"",
			"",
			"# Step 3: Push the changes to the remote repository",
			"git push -u origin --all",
			"",
			"# Step 4: Create a pull request in Azure DevOps",
			"$$pullRequest = az repos pr create `",
			"--source-branch \"${3:users/tomas.prokop/add-data-model}\" `",
			"--target-branch \"${4:main}\" `",
			"--title \"${5:feat: Add warehouse item and transaction tables}\" `",
			"--description \"${6:This pull request adds the warehouse item and transaction tables with attributes to the data model.}\" `",
			"--delete-source-branch true `",
			"--auto-complete true `",
			"--project $$projectName `",
			"--repository $$repositoryName `",
			"| ConvertFrom-Json",
			"",
			"# Step 5: Approve the pull request if you have not done so already in the Azure DevOps web interface",
			"az repos pr set-vote `",
			"--id $$pullRequest.pullRequestId `",
			"--vote approve",
			"",
			"# Step 6: Checkout the main branch and pull the latest changes from the remote",
			"git checkout main",
			"git pull origin main",
			"",
			"",
			"# Continue with the module steps by typing CFG..."
		]
	},
}
