{
	"Create an Azure DevOps remote repository and push changes": {
		"scope": "powershell",
		"prefix": "CFC01-create-remote-repo",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║            CFC01: Create an Azure DevOps remote repository and push changes            ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# A remote repository is can be hosted on a platform like Azure DevOps or GitHub.",
			"# It allows multiple developers to collaborate on the same project by pushing and pulling",
			"# changes. When a developer pushes changes to the remote, others can pull those changes into ",
			"# their local repositories, ensuring everyone is working with the latest code.",
			"#",
			"# Continuous Integration (CI) is an automated process where changes pushed to the remote ",
			"# repository trigger builds and tests, ensuring that the codebase remains functional. ",
			"# Integrating changes frequently helps avoid conflicts and errors in larger teams.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Set variables",
			"\\$adoOrgName = \"${2:thenetworg}\"",
			"\\$projectName = \"${3:DemoInventoryManagement}\"",
			"\\$repositoryName = \"${4:DemoInventoryManagement}\"",
			"",
			"# Step 2: Log in to Azure CLI using your organizational account",
			"# Note: to skip subscriptions selection, you can set the following configuration",
			"az config set core.login_experience_v2=off",
			"",
			"az login --allow-no-subscriptions --tenant ${1:networg.com}",
			"",
			"# Step 3: Create a new Azure DevOps project with Git as the source control",
			"az devops project create --name \\$projectName --source-control git --organization \"https://dev.azure.com/\\$adoOrgName\"",
			"",
			"# Step 4: Set Azure DevOps CLI defaults",
			"az devops configure --defaults \"organization=https://dev.azure.com/\\$adoOrgName project=\\$projectName\"",
			"",
			"# Step 5: Connect the local Git repository to the new remote repository",
			"git remote add origin \"https://\\$adoOrgName@dev.azure.com/\\$adoOrgName/\\$projectName/_git/\\$repositoryName\"",
			"",
			"# Step 6: Get the repository ID",
			"\\$repositoryObject = az repos show --repository \\$repositoryName --project \"\\$projectName\" --output json",
			"\\$repositoryId = (\\$repositoryObject | ConvertFrom-Json).id",
			"",
			"# Step 7: Push the current changes to the remote repository",
			"git push -u origin --all",
			"",
			"# Step 8: Open the project in a browser",
			"az devops project show --open --project \\$projectName"
		]
	},
	"Set up branch policy to prevent direct pushes to main": {
		"scope": "powershell",
		"prefix": "CFC02-setup-branch-policy",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║               CFC02: Set up branch policy to prevent direct pushes to ${1:main}             ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# A branch policy is essential for maintaining code quality and stability in a collaborative",
			"# development environment. By preventing direct pushes to the ${1:main} branch, you ensure that all",
			"# changes go through a review process via pull requests (PRs).",
			"# This allows other team members to review, comment, and approve changes before they are merged ",
			"# into the ${1:main} branch, reducing the risk of bugs or issues being introduced into production code.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Set up the branch policy to require at least one approver and prevent direct pushes to '${1:main}'.",
			"az repos policy approver-count create `",
			"--allow-downvotes true `",
			"--blocking true `",
			"--creator-vote-counts true `",
			"--enabled true `",
			"--minimum-approver-count 1 `",
			"--reset-on-source-push true `",
			"--branch \"${1:main}\" `",
			"--repository \\$repositoryId `",
			"--project \"\\$projectName\"",
			"",
			"# Step 2: Review the branch policy settings in the Azure DevOps project settings",
			"Start-Process \"https://dev.azure.com/\\$adoOrgName/\\$projectName/_settings/repositories?_a=policiesMid&repo=\\$repositoryId&refs=refs/heads/${1:main}\""
		]
	},
	"Create a pull request to merge changes into main branch": {
		"scope": "powershell",
		"prefix": "CFC03-create-pull-request",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║             CFC03: Create a pull request to merge changes into main branch             ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# A pull request (PR) is a request to merge changes from one branch into another, typically",
			"# from a user branch into the main branch. It allows team members to review the changes,",
			"# provide feedback and approve the changes before they are merged. This process helps maintain",
			"# code quality and ensures that all changes are properly vetted before being integrated into",
			"# the main codebase.",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Create a pull request to merge changes from the current branch into the main branch",
			"$$pullRequest = az repos pr create `",
			"--source-branch \"${2:users/tomas.prokop/project-setup}\" `",
			"--target-branch \"${1:main}\" `",
			"--title \"Initial project setup\" `",
			"--description \"This pull request sets up the initial project structure and configuration.\" `",
			"--delete-source-branch true `",
			"--auto-complete true `",
			"--project $$projectName",
			"--repository $$repositoryId",
			"",
			"$$pullRequest = $$pullRequest | ConvertFrom-Json",
			"",
			"# Step 2: Open the pull request in a web browser for review and approval",
			"az repos pr show --id $$pullRequest.pullRequestId --open",
		]
	},
	"Approve the pull request": {
		"scope": "powershell",
		"prefix": "CFC04-approve-pull-request",
		"body": [
			"#",
			"# ╔════════════════════════════════════════════════════════════════════════════════════════╗",
			"# ║         CFC04: Approve the pull request to merge changes and pull updated main         ║",
			"# ╚════════════════════════════════════════════════════════════════════════════════════════╝",
			"#",
			"# The previously created pull request needs to be approved because we have set up a branch policy",
			"# that requires at least one approver before merging changes into the main branch. This step",
			"# ensures that the changes are reviewed and approved by a team member",
			"#",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"#                                        Commands",
			"# ──────────────────────────────────────────────────────────────────────────────────────────",
			"# Step 1: Approve the pull request if you have not done so already in the Azure DevOps web interface",
			"az repos pr set-vote `",
			"--id $$pullRequest.pullRequestId `",
			"--vote approve",
			"",
			"# Step 2: Checkout the main branch and pull the latest changes from the remote",
			"git checkout main",
			"git pull origin main",
			"",
			"# Continue with the next module by typing CFD..."
		]
	}
}